# 浏览器渲染原理
渲染引擎在不同浏览器中不是都相同的，众所周知Firefox使用的是Gecko, 而Safari和Chrome都是基于webkit衍生出来的, 这里主要分析的是webkit的部分

## 浏览器接收到HTML文件并转换为DOM树

当打开一个网页的时候，浏览器会自动去请求对应的HTML文件，虽然我们平时写代码都会分成JS HTML和CSS文件，也就是字符串， 但是计算机并不理解，网络中传输的内容都是`0`或`1`的字节数据，当浏览器接收到这些字节数据时, 就会转换为字符串, 也就是我们平时写的代码。

当数据转换为字符串之后，浏览器会先将这些字符串通过词法分析转换为标记(token), 这一过程在词法分析中叫做标记化。

什么是标记?其实这属于编译原理的内容。简单的来说，标记的还是字符串，是构成代码的最小单位。这个过程将代码分成一块一块的小块，并且给这些内容都打上标记，便于理解这一块的内容具体是个什么意思。

标记结束后，这些小块就转换为Node, 最后这些Node会根据不同Node之前的联系构建为一棵DOM树。

以上就是浏览器从网络中接收到HTML文件后的过程。

HTML文档 => 字符串 => Token => Node => DOM树

## 将CSS文件转换为CSSOM树

转换CSS到CSSOM树和上面转换HTML到DOM树是极其相似的，过程如下:

字节数据 => 字符串 => Token => Node => CSSOM树

在这一过程中，浏览器要确定每一个节点的样式到底是什么，并且这一过程是相当消耗资源的。因为样式你可以自行设置某个节点，也可以继承自上级节点。在这一过程中浏览器必须要递归CSSOM树来确定具体的元素到底是什么样子。

举个例子:

```
<div>
  <a> <span></span> </a>
</div>
<style>
  span {
    color: red;
  }
  div > a > span {
    color: red;
  }
</style>
```

第一个span的color, 就非常容易，直接设置就完了，但是第二个span，需要先找到所有的span，然后在找到上级是a标签的span，最后还要找a标签上级是div的那一个a标签，然后再给这样的span设置样式。这样递归的过程就很消耗资源，因此我们在写css的时候避免写过于具体的选择器，并且要尽量避免添加无意义的标签，保证层级扁平

## 生成渲染树