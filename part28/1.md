# 简易计算机网络

## 早期的计算机网络

要将两个设备连接在一起，我们可以给他们之间连接一条线，然后这条线通过发送0101去让另一台设备接收数据。但是这样的方式，如果数量达到了50台，每两台设备之间都需要连接一条线，那这样的线就太多了。

因此，在计算机网络设计之初，就提出两个重要的概念:

+ 转发: 可以通过一个专门的设备去转发数据
+ 标识: 每一台设备有自己的一个专属标识

## 设备

### 集线器(HUB)————物理层

早期出现的第一个重要设备就是集线器, 他的主要功能就是做一个消息的转发。

HUB的转发非常暴力，比如一个小型网络中有1，2，3，4，5五台设备，通过一个HUB连接在一起，这个时候 1 发送了一条数据，HUB会将这条数据无条件的同时发送到2 3 4 5 另外四台设备上。

这样的暴力发送方式，设计成本非常的低，也不需要去考虑其他算法问题。但是这样就造成了一个问题，就是1的数据只想发给4怎么办？

这样就有了第一种解决方式，就是给数据包带一个相应的标识，并且在接收端收到这个数据包之后，发现这个数据包是给我的，我才会消费掉他。

但是这样的设计还是有问题，比如1 和 2同时发送数据，但是这个集线器只能处理电信号，他没办法去分辨两个信号，因此在转发的时候就会将这两个消息杂糅起来发送给其他设备，这样就会造成4收到的消息是两个消息融合起来的，这就造成了任何一个消息他都无法解析出来。

针对上述问题，提出了一种协议叫做CSMA/CD, 主要就是在发送前先进行载波侦听，通过载波侦听的方式先检查链路上有没有其他人正在发送数据。如果没有在进行数据的发送。用于防止冲突。

上面的方式就是计算机网络设计之初使用的一种方式

#### 以上方式的缺点

1. 进行数据广播会造成带宽利用率低下
2. 链路上同时只能有一个设备发送数据，导致链路利用率低。

如果说网络规模不断的扩大，比如说到了10w台设备，每一瞬间只有一台设备发送数据，那么可能就会大多数人可能一天都不能发一条数据，因此，这样的方式仅仅适合几台设备的网络。

`因此为了修复上述缺陷，提出了第二个重要的设备————交换机(SW)`

### 交换机(SW)————数据链路层

首先`集线器(HUB)`并没有记录每一台设备的唯一标识，他只是将数据广播出去，让设备自己判断消息是不是自己的，因此这样的方式工作方式效率低下。

但是`交换机(SW)`是可以记住地址的，虽然他主要是记录了一个地址和端口的映射关系。

这个地址又叫mac地址。打开网络的连接属性里面就有MAC地址(物理地址), 它分为6个分段，每一段是8个比特，所以他一共是48bit的一个标识。mac地址是出场就写死的，并且是全球唯一的地址(当然，想改还是可以改的)。

交换机记录地址和端口的方式，交换机中有一张表，表上面每一项有两个字段，一个是mac地址，一个是端口。

比如说一个交换机中有三个表，分别有三个mac地址，mac1，mac2，mac3，并且他们对应的端口是1 2 3

如果说此时机器1想要和机器3通信，他就会将数据发送到交换机，交换机会去查看自己维系的那张表，发现mac3对应的是3号端口，所以他就会将机器1发来的数据从3号口发出去。

因此在这样的工作方式下，交换机不需要将数据进行`广播`，只需要进行`单播`就可以了。

第二点就是, 交换机是`全双工`的。上面提到集线器使用的是双绞线，双绞线在进行工作的时候只能有一台设备进行发送，但是交换机不同，交换机使用的是我们现在的网线，一根网线内部有8根双绞线，正常情况下有4根线在工作，这样的方式下可以实现数据的全双工。

也就是实现1号发送数据时候，1号还可以接收数据，同时1发送，2也可以发送。

交换机维系的表如何建立的地址：

首先买来一台交换机，上面有几个口，可以接一些设备了，初始化的时候是一张空表。他建立映射关系的过程如下：

1. 接了三台机器A， B， C
2. 首先A要向B发送数据，A发了之后上来先查表，发现这张表中没有任何数据，同时在A发送上来之后确定了一个消息，就是A的mac地址对应的是1号口，因此将macA对应1记录到了表中，但是此时要需要找的是B对应的端口，但是他发现表里面没有，这个时候就会向没得端口分别发送数据。
3. 其中4号端口是B，4做出了回应，这个时候就会将macB对应的4记录到表中
4. 通过上面的方式，就将所有连接在其上的机器mac地址所对应的端口记录到了维系的表中

交换机所在的层级叫做`数据链路层`, 数据链路层的数据分`数据头`和`数据部分`

数据头中记录了原地址、目的地址, 目的地址指的是mac地址。这是对集线器的一个大改进，生活中已经基本上看不到集线器了。

交换机有一个特点，就是可以进行`桥接`

比如有两台交换机， 可以通过他们上面的两个端口进行桥接。

桥接之后交换机一上面有A, B 两个设备，交换机二上面有C, D 两个设备。

交换机一中维系的地址表是A对应1号口，B对应4号口

然后A向C发送消息时，实际上在交换机一当中是没有找到的，那么他就会广播发送，当他广播到了5号口的时候就进入到了交换机二，在交换机二中记录了C对应的3号口，D对应的4好口，因此他就将数据发送到了交换机二的3号口上，也就是C。

同时交换机二会在数据接收后，记录A对应的是1号口，当然如果B也发送消息，他还是会记录B也是1号口。

另一边在交换机一中同样会在A发送数据，并且C收到后，记录C(D)在5号口。

这样可以看到多个mac地址是可以对应同一个物理端口的。

当然一般家用交换机大概容量在几千的层次，当然这里的这个地址映射表不是路由表，他只是交换机，还没有到路由那一层。

#### 交换机模式的弊端

首先几千的映射表存储量是比较小的，想要在全球范围内建立计算机互联网络，他就不够用了。可能需要几十E个，如果没有记录对应的路由信息，就会一直广播，如果多个交换机使劲连接，他没有对应的表，就会不停的跨交换机去广播，这样效率很低，造成消息洪泛。

可以看到目前使用交换机和mac地址结合的这种方式，可以在一个比较小的局域网络内达到一个高效的传输。比如一个工作室，校园或者家庭网络，这样的一个局域网传输速度就会很快。

但是如果规模不断扩大，这种方式就力不从心了。

#### 为什么mac地址叫物理地址，但是交换机在数据链路层？

首先物理层是一个早期概念，集线器已经基本上不再使用了。在一个每台设备要有一个标识，这个标识从概念上来讲确实是一个物理地址，因此这个mac地址叫做物理地址。

#### 交换机最大的优势

小型网络内可以高效传播

### 路由器——网络层

由于上述交换机的缺点，在跨网络时映射表爆满和消息洪泛的缺点，因此在跨网络时，引入新的设备————`路由器`，有时候也叫做网关。

有了路由器之后，在网络1和网络2上面分别有一个设备A和设备B，设备A向B发送数据，就是通过路由器转发的，从网络1转发到网络2

网络是一个抽象概念，并不是划定的固定地址。因此在标识上面就要提出另一个标识————ip地址

#### ip地址重要作用

+ 标识网络
+ 标识设备在哪个网络下

主要是给设备和网络做了一个关联

比如说家庭的网络是192.168.0.0/24. 但是我的设备是192.168.0.102。

因此192.168.0.102就用于标识当前的设备，但是192.168.0.0/24这个网络号，就用来标识当前设备所在的网络

在当前网络中每一台设备都有自己维护的路由表，路由器也有路由表。

如果我是192.168.0.102，但是我ping了一个192.168.1.254。为什么可以ping通呢？

原因就是我自己的ip是192.168.0.102，我自己的路由表会写默认网关是192.168.0.1，这个0.1在路由器上，因此我的设备就会将数据包发到路由器上，发到路由器上后，路由器也有一个路由表，路由表中记录了192.168.1.0这个网络通过端口地址192.168.1.51，通过这个网卡进行发送，数据包就会从102传到0.1，经过1.51这个网卡发送到网络一，然后网络一因为1.51和1.254在同一个网络下，所以很容易就找到了1.254.

路由器的工作原理，就是他既有网络一的ip，又有网络二的ip

路由表的建立算法还在不断的迭代中，主要是指自动建立最优路径表的算法。

#### 还有一点比较重要，就是1.51到1.254这个过程是何如传输的？(网络内的传输)

引入路由器是为了跨网络进行数据转发，ip是一个抽象的ip，ip地址不能直接作为通信，因为他是一个抽象地址。通信只能使用mac地址，因此从1.51到1.254的过程是下面这样的：

1. 首先1.51查找1.254的mac地址，有一个协议叫做`ARP`协议，是在网络中去广播谁的地址是1.254，当1.254收到之后就会回应我的地址是1.254，我的mac地址是xxx，就会将这个消息发给1.51，然后1.51就知道了1.254对应的mac地址，然后可以在mac层进行传输了，也就是数据链路层。

路由器这一层叫做网络层。

实际上的传输都走的mac层，都要先查找mac地址，然后在mac层进行传输。

ip的数据包实际上就是mac地址的数据部分。

ip的包也分头和数据, ip包中的头部分包含ip的原地址，ip的目的地址。

然后ip的数据中还包含TCP/UDP的数据，分TCP/UDP的头, 在往上还有http的头，行和体，一层一层包，最里面才是我们传递的数据部分

