# UDP

网络协议是每个前端工程师都必须要掌握的只是，我们将先来学习传输层的两个协议: UDP以及TCP。对于大部分工程师来说最常用的协议也就是这两个了，并且在面试中经常会提问的也是关于这两个协议的区别。

`常见题目： UDP与TCP的区别`

首先UDP协议是面向无连接的，也就是说不需要在正是传递数据之前先连接双方。然后UDP协议只是数据报文的搬运工，不保证有序且不丢失的传递到对端，并且UDP协议也没有任何控制流量的算法，总的来说UDP相较于TCP更加的轻便。

## 面向无连接

首先UDP是不需要和TCP一样在发送数据前进行三次握手建立连接的，想发数据就可以开始直接发送了。

并且他只是数据报文的搬运工，不会对数据报文进行任何的拆分和拼接操作。

具体来说：

+ 在发送端，应用层将数据传给传输层的UDP协议，UDP只会给数据增加一个UDP头标识下是UDP协议，然后就传递给网络层了
+ 在接收端，网络层将数据传递给传输层，UDP只去除IP报文头就传递给应用层，不会任何拼接操作。

## 不可靠性

首先不可靠性体现在无连接上，通信都不需要建立连接，想发灸法，这样的情况肯定不可靠。

并且收到什么数据就传递什么数据，并且也不会备份数据，发送数据也不会关心对方是否已经正确接收到数据了。

再者网络环境时好时坏，但是UDP因为没有拥塞机制，一直会以恒定的速度发送数据。即使网络条件不好，也不会对发送速率进行调整。这样实现的弊端就是在网络条件不好的情况下可能会导致丢包，但是优点也很明显，在某些实时性要求搞的场景(比如电话会议)就需要使用UDP而不是TCP。

## 高效

虽然UDP协议不是那么的可靠，但是正式因为他不是那么的可靠，所以才没有TCP那么的复杂，需要保证数据不丢失且有序到达。

因为UDP的头部开销小，只有8字节，相比TCP的至少二十字节要少得多，在传输数据报文时是很高效的。

UDP头部包含了以下几个数据：

+ 两个十六位的端口号，分别是源端口(可选字段)和目标端口
+ 整个数据报文的长度
+ 整个数据报文的校验(IPv4可选字段)，该字段用于发现头部信息和数据中的错误

## 传输方式

UDP不止支持一对一的传输方式，同样支持一对多，多对多，多对一的方式，也就是说UDP提供了单播，多播，广播的功能。

## 适合使用的场景

UDP虽然比TCP有很多缺陷，但正是因为这些缺陷造就了他高效性的特性，在很多实时性要求很高的地方都可以看到UDP的身影。

### 直播

TCP会严格控制传输的正确性，一旦某个数据对端没有收到，就会停下来直到对端收到这个数据。这种问题在网络条件不错的情况下可能并不会发生什么事情，但是在网络情况差的时候就会变成画面卡住，然后在继续播放下一帧的情况。

但是对于直播来说，用户关注的肯定是最新的画面，而不是因为网络条件差而都是的老旧画面，所以TCP在这种情况下没有用武之地，只会降低用户体验。

### 游戏

对于游戏这种实效性要求很高的场景来说，UDP是跑不掉的。

由于游戏中用户量较大，如果使用TCP连接，可能会出现最大连接数不够的情况，然后就会丢包，每台服务器可供支撑的TCP连接数量是有限制的。

再者说，因为TCP会严格控制传输的正确性，如果因为用户网络条件不好就造成页面卡顿然后再传输旧的画面肯定不能接受的，毕竟对于这类实效性很高的场景，最新的画面才是最重要的而不是老旧的画面，不然自己已经死了，但是浑然不知。

